# Zabbix RabbitMQ
Скрипт для постановки на мониторинг очередей кролика. Деплой через bamboo, jenkins, gitlab ci etc...

**Необходимые библиотеки:**
```
pip install pyyaml py-zabbix requests urllib3
```

**Скрипт `rabbitqu.py` - небоходимо положить в `/usr/lib/zabbix/externalscripts` на ноду заббикса или прокси**

Для того чтобы поставить на мониторинг новые очереди кролика, необходимо:
* Склонировать к себе репозиторий
* Добавить в файл `rabbitmq.yaml` необходиме данные, например:
```yaml
- name: Check queue example.queue in example_vhost
  env: prod
  owner: example_owner
  project: example_project
  vhost: example_vhost
  queue: example.queue
  warning: 1000
  average: 2000
  high: 5000
  disaster: 10000
```

## Обязательные параметры

* `name` - имя проверки
* `env` - среда
* `owner` - тэг владельца
* `project` - тэг команды/проекта
* `vhost` - виртульный хост в кролике
* `queue` - очередь в кролике
* `warning` - порог триггера Warning, после которого он срабатывает
* `average` - порог триггера Average, после которого он срабатывает
* `high` - порог триггера High, после которого он срабатывает
* `disaster` - порог триггера Disaster, после которого он срабатывает

### ВСЕ ПАРАМЕТРЫ ОБЯЗАТЕЛЬНЫ!!!

## Обновление и удаление
Разрешено изменять: `env`, `owner`, `project`

Разрешено обновлять имеющиеся пороговые значения, но они не должны пересекаться с предыдущими:  

* *warning*
* *average*
* *high*
* *disaster*

Чтобы удалить проверку, удалите ее из файла и сделайте push в репозиторий.

P.S. Не пытайтесь менять имя проверки (name). Это приведет к тому, что старая проверка удалится и создастся новая, потеряв при этом историю.